<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>HTML檔產生器</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  	<!-- Compiled and minified CSS -->
  	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">
  	<!-- Compiled and minified JavaScript -->
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>

	<style>
		footer {
			position: fixed;
			bottom: 0px;
			width: 100vw;
		}
	</style>
</head>

<body>
	<div class="container">


		<div class="col s12">
			<ul class="collapsible" data-collapsible="accordion">
				<li>
					<div class="collapsible-header teal lighten-2"><span class="badge"></span><i class="material-icons"></i>1. 建立基本架構</div>
					<div class="collapsible-body">
						<div class="row">
							<div class="col s6 offset-s3">
								<div class="input-field col s12">
									<input type="text" id="file_name">
									<label for="file_name">檔案名稱：</label>
								</div>

								<div class="input-field col s12">
									<input type="text" id="subject">
									<label for="subject">標題名稱：</label>
								</div>

								<div class="input-field col s12">
									<a class="waves-effect waves-light btn" id="add_scope">產生架構</a>
								</div>
							</div>
						</div>

					</div>
				</li>

				<li>
					<div class="collapsible-header teal lighten-2"><span class="badge"></span><i class="material-icons"></i>2. 建立此頁規格</div>
					<div class="collapsible-body">
						<div class="row">
							<div class="col s6 offset-s3">
								<blockquote>
									貼上的順序會影響欄位名稱和DB名稱的mapping
								</blockquote>
							</div>

							<div class="col s6 offset-s3">
								<div class="input-field col s12 center-align">
									<textarea id="db_name" class="materialize-textarea"></textarea>
									<label for="db_name">DB名稱</label>
								</div>
							</div>

							<div class="col s6 offset-s3">
								<div class="input-field col s12 center-align">
									<textarea id="field_name" class="materialize-textarea"></textarea>
									<label for="field_name">欄位名稱</label>
								</div>
							</div>

							<div class="col s6 offset-s3">
								<div class="input-field col s12 center-align">
									<a class="waves-effect waves-light btn" id="update_data">更新資料</a>
								</div>
							</div>
						</div>
					</div>
				</li>

				<li>
					<div class="collapsible-header teal lighten-2"><span class="badge"></span><i class="material-icons"></i>3. 產生內容</div>
					<div class="collapsible-body">
						<form>
							<div class="row">
								<div class="col s6 offset-s3">
									<div class="input-field col s12">
										<select id="row_type">
											<option value="half">4欄</option>
											<option value="one">2欄</option>
										</select>
										<label>欄位寬度</label>
									</div>
								</div>


								<div class="col s6 offset-s3">
									<div class="input-field col s12">
										<!--<input type="text" id="title">
										<label for="title">欄位名稱：</label>-->
										<select id="title"></select>
										<label>欄位名稱</label>
									</div>
								</div>

								<div class="col s6 offset-s3">
									<p>
										<input type="checkbox" id="is_required" value="y" />
										<label for="is_required">是否為必填欄位</label>
									</p>
								</div>



								<div class="col s6 offset-s3">
									<div class="input-field col s12">
										<select id="type">
											<option value="text">Input Text</option>
											<option value="select">Select</option>
											<option value="checkbox">checkbox</option>
											<option value="radio">Radio</option>
											<option value="textarea">Textarea</option>
										</select>
										<label>欄位內容物格式</label>
									</div>
								</div>


								<div class="col s6 offset-s3">
									<div class="input-field col s12">
										<a class="waves-effect waves-light btn" id="add_btn">加入</a>
									</div>
								</div>

							</div>
						</form>
					</div>
				</li>

			</ul>

			<div class="col s12">
				<div class="input-field col s12">
					<textarea id="code" class="materialize-textarea"></textarea>
					<label for="code">Code預覽</label>
				</div>
			</div>
		</div>
	</div>

	<footer class="page-footer">
		<div class="footer-copyright">
			<div class="container">
				Builded by Karen Hsieh on 2016-12-29 with
				<a class="grey-text text-lighten-4" href="http://materializecss.com/">Materialize Style</a>
			</div>
		</div>
	</footer>
</body>
</html>

<script type="text/javascript">
	//var G_SCOPE = "";

	function getScope(responseScope) {
		$.ajax({
			url: "getScope.php",
			data: "",
			type:"POST",
			dataType:'html',

			success: function(msg){
				responseScope(msg);
			},

			error:function(xhr, ajaxOptions, thrownError){
				alert(xhr.status);
				//alert(thrownError);
			}
		});
	};


	var htmlcode = function() {
		this.whole_row = '<div class="rwd_form_row"><div class="rwd_form_left"></div><div class="rwd_form_right"></div></div>';
		this.half_row = '<div class="rwd_form_row 4col"><div class="rwd_form_left"></div><div class="rwd_form_right"></div></div>';

		this.input_text = '<input name="db_name" type="text" id="txt_" />';
		this.textarea = '<textarea name="db_name" id="tarea"></textarea>';
		this.select = '<select name="db_name" id="slt_"></select>';
		this.checkbox = '<input name="db_name" type="checkbox" id="checkbox_" />';
		this.radio = '<input name="db_name" type="radio" id="radio_" />';
	}


	$(document).ready(function () {

    	$('select').material_select();
		$("textarea").on("change", function(){
			$(this).trigger('autoresize');
		});
		$(".collapsible-header:first").click();


		$("#add_scope").on("click", function() {
			var file_name = $("#file_name").val();
			var subject = $("#subject").val();

			getScope(function(res){
				//console.info(typeof (res));

				if(file_name != ""){
					res = res.replace("thisisjsfile", file_name);
				}

				if(subject != ""){
					res = res.replace('<title></title>', '<title>'+subject+'</title>');
					res = res.replace('<div class="rwd_form_caption"></div>', '<div class="rwd_form_caption">'+subject+'</div>');
				}

				var pre_code = $("#code").text();
				$("#code").text(pre_code+"\r\n\r\n"+res).trigger('autoresize');
				$(".collapsible-header:eq(1)").click();
				//console.info(res);
			});
		})


		$("#update_data").on("click", function(){

			var field_name = [];
			var db_name = [];

			var f_lines = $("#field_name").val().split('\n');
			for(var i = 0;i < f_lines.length;i++){
				field_name.push(f_lines[i]);
			}

			var d_lines = $("#db_name").val().split('\n');
			for(var i = 0;i < d_lines.length;i++){
				db_name.push(d_lines[i]);
			}


			$("#title").find("option").remove().material_select();
			$.each(field_name, function(index, data){
				$("#title").append("<option value='"+db_name[index]+"'>"+data+"</option>");
				$("#title").material_select();
			});
			$(".collapsible-header:eq(2)").click();
		});


		$("#add_btn").on("click", function() {
			var row_type = $("#row_type").find(":selected").val();
			var title = $("#title").find(":selected").text();
			var db_name = $("#title").find(":selected").val();
			var is_required = $("#is_required").val();
			var type = $("#type").find(":selected").val();

			var getCode = new htmlcode();

			var temp_code = "";

			if(row_type == "one"){
				temp_code = getCode.whole_row;
			} else {
				temp_code = getCode.half_row;
				temp_code = temp_code.replace("rwd_form clearfix", "rwd_form clearfix complex");
			}


			if (is_required == "y" && title != "") {

				temp_code = temp_code.replace('<div class=\"rwd_form_left\"></div>', '<div class="rwd_form_left"><span class="required">' + title + ": </span></div>");

			} else if (is_required != "y" && title != "") {

				temp_code = temp_code.replace('<div class="rwd_form_left"></div>', '<div class="rwd_form_left">' + title + ": </div>");

			}

			var inner_code = "";
			switch(type){
				case "text":
					inner_code = getCode.input_text;
					inner_code = inner_code.replace("db_name", db_name).replace("txt_", "txt_"+db_name);
					break;
				case "select":
					inner_code = getCode.select;
					inner_code = inner_code.replace("db_name", db_name).replace("slt_", "slt_"+db_name);
					break;
				case "checkbox":
					inner_code = getCode.checkbox;
					inner_code = inner_code.replace("db_name", db_name).replace("checkbox_", "checkbox_"+db_name);
					break;
				case "radio":
					inner_code = getCode.radio;
					inner_code = inner_code.replace("db_name", db_name).replace("radio_", "radio_"+db_name);
					break;
				case "textarea":
					inner_code = getCode.textarea;
					inner_code = inner_code.replace("db_name", db_name).replace("tarea_", "tarea_"+db_name);
					break;
			}

			temp_code = temp_code.replace('<div class="rwd_form_right">','<div class="rwd_form_right">'+inner_code);

			$("#is_required").prop('checked', false);
			var pre_code = $("#code").text();

			var full_code = pre_code.replace("//FillContent", temp_code+"\r\n //FillContent");
			$("#code").text(full_code).trigger('autoresize');
		});


	});

</script>
