<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>HTML檔產生器</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  	<!-- Compiled and minified CSS -->
  	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">
  	<!-- Compiled and minified JavaScript -->
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>

</head>
<body>

	<div class="container">


		<div class="col s12">
			<ul class="collapsible" data-collapsible="accordion">
				<li>
					<div class="collapsible-header teal lighten-2"><span class="badge"></span><i class="material-icons"></i>1. 建立基本架構</div>
					<div class="collapsible-body">
						<div class="row">
							<div class="col s6 offset-s3">
								<div class="input-field col s12">
									<input type="text" id="file_name">
									<label for="file_name">檔案名稱：</label>
								</div>

								<div class="input-field col s12">
									<input type="text" id="subject">
									<label for="subject">標題名稱：</label>
								</div>

								<div class="input-field col s12">
									<a class="waves-effect waves-light btn" id="add_scope">產生架構</a>
								</div>
							</div>
						</div>

					</div>
				</li>

				<li>
					<div class="collapsible-header teal lighten-2"><span class="badge"></span><i class="material-icons"></i>2. 建立此頁規格</div>
					<div class="collapsible-body">
						<div class="row">
							<div class="col s6 offset-s3">
								<blockquote>
									貼上的順序會影響欄位名稱和DB名稱的mapping
								</blockquote>
							</div>

							<div class="col s6 offset-s3">
								<div class="input-field col s12 center-align">
									<textarea id="db_name" class="materialize-textarea"></textarea>
									<label for="db_name">DB名稱</label>
								</div>
							</div>

							<div class="col s6 offset-s3">
								<div class="input-field col s12 center-align">
									<textarea id="field_name" class="materialize-textarea"></textarea>
									<label for="field_name">欄位名稱</label>
								</div>
							</div>

							<div class="col s6 offset-s3">
								<div class="input-field col s12 center-align">
									<a class="waves-effect waves-light btn" id="update_data">更新資料</a>
								</div>
							</div>
						</div>
					</div>
				</li>

				<li>
					<div class="collapsible-header teal lighten-2"><span class="badge"></span><i class="material-icons"></i>3. 產生內容</div>
					<div class="collapsible-body">
						<form>
							<div class="row">
								<div class="col s6 offset-s3">
									<div class="input-field col s12">
										<!--<input type="text" id="title">
										<label for="title">欄位名稱：</label>-->
										<select id="title"></select>
										<label>欄位名稱</label>
									</div>
								</div>

								<div class="col s6 offset-s3">
									<p>
										<input type="checkbox" id="is_required" value="y" />
										<label for="is_required">是否為必填欄位</label>
									</p>
								</div>

								<div class="col s6 offset-s3">
									<div class="input-field col s12">
										<select id="row_type">
											<option value="half">1/2列</option>
											<option value="one">一列</option>
										</select>
										<label>欄位寬度</label>
									</div>
								</div>

								<div class="col s6 offset-s3">
									<div class="input-field col s12">
										<select id="type">
											<option value="select"></option>
											<option value="radio">一列</option>
										</select>
										<label>欄位內容物格式</label>
									</div>
								</div>


								<div class="col s6 offset-s3">
									<div class="input-field col s12">
										<a class="waves-effect waves-light btn" id="add_btn">加入</a>
									</div>
								</div>

							</div>
						</form>
					</div>
				</li>

			</ul>

			<div class="col s12">
				<div class="input-field col s12">
					<textarea id="code" class="materialize-textarea"></textarea>
					<label for="code">Code預覽</label>
				</div>
			</div>
		</div>
	</div>
</body>
</html>

<script type="text/javascript">
	//var G_SCOPE = "";

	function getScope(responseScope) {
		$.ajax({
			url: "getScope.php",
			data: "",
			type:"POST",
			dataType:'html',

			success: function(msg){
				responseScope(msg);
			},

			error:function(xhr, ajaxOptions, thrownError){
				alert(xhr.status);
				//alert(thrownError);
			}
		});
	};


	var htmlcode = function() {
		this.whole_row = '<div class="rwd_form_row"><div class="rwd_form_left"></div><div class="rwd_form_right"></div></div>';
		this.half_row = '<div class="rwd_form_row half"><div class="rwd_form_left"></div><div class="rwd_form_right"><input name="elementName" type="text" id="elementName"/></div></div>';
	}


	$(document).ready(function () {

    	$('select').material_select();
		$("textarea").on("change", function(){
			$(this).trigger('autoresize');
		});
		$(".collapsible-header:first").click();


		$("#add_scope").on("click", function() {
			var file_name = $("#file_name").val();
			var subject = $("#subject").val();

			getScope(function(res){
				//console.info(typeof (res));

				if(file_name != ""){
					res = res.replace("thisisjsfile", file_name);
				}

				if(subject != ""){
					res = res.replace('<title></title>', '<title>'+subject+'</title>');
					res = res.replace('<div class="rwd_form_caption"></div>', '<div class="rwd_form_caption">'+subject+'</div>');
				}

				var pre_code = $("#code").text();
				$("#code").text(pre_code+"\r\n\r\n"+res).trigger('autoresize');
				$(".collapsible-header:eq(1)").click();
				//console.info(res);
			});
		})


		$("#update_data").on("click", function(){

			var field_name = [];
			var db_name = [];

			var f_lines = $("#field_name").val().split('\n');
			for(var i = 0;i < f_lines.length;i++){
				field_name.push(f_lines[i]);
			}

			var d_lines = $("#db_name").val().split('\n');
			for(var i = 0;i < d_lines.length;i++){
				db_name.push(d_lines[i]);
			}


			$("#title").find("option").remove().material_select();
			$.each(field_name, function(index, data){
				$("#title").append("<option value='"+db_name[index]+"'>"+data+"</option>");
				$("#title").material_select();
			});
			$(".collapsible-header:eq(2)").click();
		});


		$("#add_btn").on("click", function() {
			var row_type = $("#row_type").find(":selected").val();
			var title = $("#title").find(":selected").text();
			//console.info(title);
			var is_required = $("#is_required").val();

			var getCode = new htmlcode();

			var temp_code = "";

			if(row_type == "one"){
				temp_code = getCode.whole_row;
			} else {
				temp_code = getCode.half_row;
			}


			if (is_required == "y" && title != "") {

				temp_code = temp_code.replace('<div class=\"rwd_form_left\"></div>', '<div class="rwd_form_left"><span class="required">' + title + ": </span></div>");

			} else if (is_required != "y" && title != "") {

				temp_code = temp_code.replace('<div class="rwd_form_left"></div>', '<div class="rwd_form_left">' + title + ": </div>");

			}

			$("#is_required").prop('checked', false);
			var pre_code = $("#code").text();

			var full_code = pre_code.replace("//FillContent", temp_code+"\r\n //FillContent");
			$("#code").text(full_code).trigger('autoresize');
		});


	});

</script>
